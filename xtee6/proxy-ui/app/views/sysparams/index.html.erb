<% content_for :head do %>
  <%= javascript_include_tag "sysparams" %>
<% end %>

<% content_for :content do %>
  <fieldset class="borderless">
    <legend><%= t 'anchor.title' %></legend>

    <table class="details">
      <tr>
        <td><%= t 'common.hash' %></td>
        <td class="anchor-hash"></td>
      </tr>
      <tr>
        <td><%= t 'common.generated' %></td>
        <td class="anchor-generated_at"></td>
      </tr>
    </table>

    <% if can?(:upload_anchor) %>
    <button id="anchor_upload"><%= t 'common.upload' %></button>
    <% end %>
    <% if can?(:download_anchor) %>
    <button id="anchor_download"><%= t 'common.download' %></button>
    <% end %>

    <%= dialog "anchor_upload_dialog", t('anchor.upload_title') do %>
      <%= form_tag "sysparams/anchor_upload", :id => "anchor_upload_form",
            :multipart => true, :target => "upload_target" do %>
        <%= file_field_tag "anchor_upload_file" %>
      <% end %>

      <iframe id="upload_target" name="upload_target"></iframe>
    <% end %>
  </fieldset>

  <fieldset class="borderless">
    <legend><%= t '.tsps' %></legend>
    <table id="tsps" class="bordered">
      <thead>
        <th><%= t '.tsp_name' %></th>
        <th><%= t '.tsp_url' %></th>
      </thead>
    </table>

    <div class="dataTables_actions">
      <% if can?(:add_tsp) %>
      <button id="tsp_add"><%= t 'common.add' %></button>
      <% end %>
      <% if can?(:delete_tsp) %>
      <button id="tsp_delete"><%= t 'common.delete' %></button>
      <% end %>
    </div>
  </fieldset>

  <% if can?(:view_async_params) %>
  <fieldset class="borderless">
    <legend><%= t '.async_params' %></legend>
    <table class="details">
      <tr>
        <td><%= t '.async_period' %></td>
        <td><%= text_field_tag 'async_period', nil, :disabled => !can?(:edit_async_params) %></td>
      </tr>
      <tr>
        <td><%= t '.async_max_period' %></td>
        <td><%= text_field_tag 'async_max_period', nil, :disabled => !can?(:edit_async_params) %></td>
      </tr>
      <tr>
        <td><%= t '.async_parallel' %></td>
        <td><%= text_field_tag 'async_parallel', nil, :disabled => !can?(:edit_async_params) %></td>
      </tr>
    </table>
    <% if can?(:edit_async_params) %>
    <button id="async_edit"><%= t 'common.save' %></button>
    <% end %>
  </fieldset>
  <% end %>

  <fieldset class="borderless">
    <legend><%= t '.internal_ssl_cert' %></legend>
    <table id="internal_ssl_cert" class="bordered">
      <thead>
        <th><%= t '.internal_ssl_cert_hash' %></th>
      </thead>
    </table>

    <div class="dataTables_actions">
      <button id="cert_details"><%= t 'shared.cert_details_dialog.cert_details' %></button>
      <button id="export_internal_ssl_cert"><%= t 'common.export' %></button>
      <% if can?(:generate_internal_ssl) %>
      <button id="generate_internal_ssl"><%= t '.internal_ssl_generate_key' %></button>
      <% end %>
    </div>
  </fieldset>

  <%= render :partial => 'tsp_add_dialog' %>
  <%= render :partial => 'shared/cert_details_dialog' %>
<% end %>
