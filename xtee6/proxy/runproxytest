#!/bin/bash

if [ "$JAVA_HOME" = "" ]
then
	javabin="java"
else
	javabin="$JAVA_HOME/bin/java"
fi

classes=build/classes/test
classname=ee.cyber.sdsb.proxy.testsuite.ProxyTestSuite

if [ "$1" = "-proxy" ]
then
	shift
	classes=build/libs/proxy-1.0.jar
	classname=ee.cyber.sdsb.proxy.ProxyMain
fi

$javabin -Dee.cyber.sdsb.proxy.ocspCachePath=build/ocsp-cache\
    -Dee.cyber.sdsb.tempFiles.path=build/attach-tmp -Xmx2000m\
    -Dee.cyber.sdsb.appLog.path=log\
    -Dee.cyber.sdsb.proxy.globalConfFile=../systemtest/conf/local_test/globalconf.xml\
    -Dlogback.configurationFile=src/test/logback-proxytest.xml\
    -Dee.cyber.sdsb.proxy.clientHandlers=ee.cyber.sdsb.proxy.clientproxy.MetadataHandler\
    -Dee.cyber.sdsb.proxy.serverServiceHandlers=ee.cyber.sdsb.proxy.serverproxy.MetadataServiceHandlerImpl\
    -Dee.cyber.sdsb.proxy.jetty-serverproxy-configuration-file=src/test/serverproxy.xml\
    -Dee.cyber.sdsb.proxy.jetty-clientproxy-configuration-file=src/test/clientproxy.xml\
    -cp ../libs/hsqldb.jar:../common-test/build/libs/common-test-1.0.jar:build/libs/proxy-1.0.jar:../addons/metaservice/build/libs/metaservice-1.0.jar:../common-verifier/build/classes/test:$classes $classname $*
